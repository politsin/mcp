upstream react_backend {
    server unix:/tmp/mcp-react-example.sock;
    keepalive 16;
}

server {
    listen 443 ssl;
    server_name example.local;

    root /var/www/html;

    # Common proxy headers
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_http_version 1.1;

    # MCP JSON endpoints and streamable HTTP
    location ^~ /mcp/http {
        proxy_read_timeout 1h;
        proxy_buffering off;
        proxy_request_buffering off;
        add_header X-Accel-Buffering no always;
        proxy_pass http://react_backend;
    }

    # SSE endpoints
    location ^~ /mcp/sse {
        proxy_read_timeout 1h;
        proxy_buffering off;
        proxy_request_buffering off;
        add_header X-Accel-Buffering no always;
        proxy_pass http://react_backend;
    }
}


